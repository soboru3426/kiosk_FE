<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>플레이버 선택</title>
  <link rel="stylesheet" href="common.css">
  <style>
    /* --- 기본 컨테이너 및 레이아웃 --- */
    .container {
      max-width: 1200px;
      margin: 30px auto;
      background: #fff;
      padding: 20px 40px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border-radius: 10px;
    }
    header.header {
      text-align: center;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    header.header h2 {
      font-size: 28px;
      color: #333;
      margin: 0;
    }
    .tab-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .tab-buttons button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-bottom: 2px solid transparent;
      background: none;
      cursor: pointer;
      transition: border-bottom 0.3s, color 0.3s;
    }
    .tab-buttons button:hover {
      color: #ff1493;
    }
    .tab-buttons button.active {
      border-bottom: 2px solid #ff1493;
      font-weight: bold;
      color: #ff1493;
    }
    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .product-info {
      text-align: center;
      margin-bottom: 30px;
    }
    #product-img {
      width: 70px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .product-my {
      display: flex;
      gap: 50px;
      justify-content: center;
      align-items: center;
    }
    #product-price {
      margin-left: 300px;
      font-size: 30px;
      color: #ff1493;
    }
    .product-info h3 {
      font-size: 22px;
      margin: 10px 0 5px;
      color: #333;
    }
    .product-info p {
      font-size: 16px;
      color: #666;
      margin: 5px 0;
    }
    
    /* --- 옵션(맛 선택) 영역 --- */
    .selection {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
    }
    .option {
      width: 200px;
      height: 150px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 10px;
      text-align: center;
      padding: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .option img {
      width: 55px;
      height: 55px;
      margin-bottom: 25px;
    }
    .option p {
      font-size: 13px;
      margin: 3px 0;
    }
    .selection .option:hover {
      background: #f5eff3;
      border: 2px solid #f85bc9;
    }
    
    /* --- 맛 선택 슬롯 영역 --- */
    .flavor-slots-container {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px auto 20px;
      max-width: 600px;
    }
    .flavor-slot {
      width: 80px;
      height: 80px;
      border: 2px dashed #ccc;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .flavor-slot.active {
      border-color: #ff1493;
    }
    .flavor-slot img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }
    .slot-placeholder {
      font-size: 30px;
      color: #ccc;
    }
    
    /* --- 플레이버(맛 옵션) 그리드 --- */
    #flavorTab {
      background: #fafafa;
      padding: 20px;
    }
    .flavor-panels {
      position: relative;
      height: 500px;
      margin-bottom: 20px;
    }
    .flavor-panel {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      display: none;
    }
    .flavor-panel.active {
      display: block;
    }
    .flavor-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .flavor-grid img {
      max-width: 150px;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border 0.3s, transform 0.3s;
    }
    .flavor-grid img:hover {
      transform: scale(1.05);
    }
    .flavor-grid img.selected {
      border: 2px solid #ff1493;
    }
    
    /* --- 페이지네이션 (숫자 없이 원형 인디케이터) --- */
    .pagination {
      text-align: center;
      margin-top: 40px;
    }
    .pagination button {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      border: none;
      background: #ccc;
      margin: 0 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .pagination button.active {
      background: #ff1493;
    }
    
    /* --- 하단 영역 (합계 가격 및 네비게이션 버튼) --- */
    .bottom-actions {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 50px;
      margin-bottom: 20px;
      gap: 20px;
    }
    .quantity-price {
      display: flex;
      align-items: center;
      gap: 20px;
      font-size: 18px;
      color: #333;
    }
    .quantity-price button {
      padding: 8px 12px;
      font-size: 18px;
      border: none;
      background: #ff1493;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .quantity-price button:hover {
      background: #ff007f;
    }
    .navigation-buttons {
      display: flex;
      justify-content: center;
      gap: 30px;
    }
    /* 이전 버튼 */
    .btn-back {
      background-color: white;
      padding: 10px;
      font-size: 20px;
      color: #ff1493;
      border-radius: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 200px;
      height: 60px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-back:hover {
      color: #ff007f;
      background-color: rgb(235,232,232);
    }
    /* 담기 버튼 */
    .btn-cart {
      background-color: #ff1493;
      color: white;
      font-size: 18px;
      width: 200px;
      height: 60px;
      padding: 10px;
      border-radius: 60px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-cart:hover {
      background-color: #ff007f;
    }
    
    #gob {
      margin-top: 20px;
      margin-bottom: 20px;
      font-size: 16px;
      color: red;
      text-align: center;
    }
  </style>
</head>
<body>  
  <div class="container">
    <header class="header">
      <div class="tab-buttons">
        <button id="tabProduct" class="active" onclick="showTab('productTab')">상품 정보</button>
        <button id="tabFlavor" onclick="showTab('flavorTab')">플레이버</button>
      </div>
    </header>

    <!-- 상품 정보 탭 -->
    <div id="productTab" class="tab-content active">
      <div class="product-info">
        <div class="product-my">
          <img id="product-img" src="./pd_cup.png" alt="상품 이미지">
          <h3 id="product-name">상품명</h3>
          <p id="product-price">₩3200</p>
        </div>
        <p>원하는 맛을 자유롭게 선택하세요!</p>
        <p id="gob">** 본 제품은 포장이 불가합니다 **</p>
        <div class="selection">
          <div class="option selected" onclick="selectOption('cup')">
            <img src="./pd_cup.png" alt="컵 이미지">
            <p>컵(포장불가)</p>
            <div class="quantity-price">
              <button onclick="changeQuantityForOption(-1, 'cup'); event.stopPropagation();">-</button>
              <span id="finalQuantity-cup">0</span>
              <button onclick="changeQuantityForOption(1, 'cup'); event.stopPropagation();">+</button>
            </div>
          </div>
          <div class="option" onclick="selectOption('cone')">
            <img src="./pd_corn.png" alt="콘 이미지">
            <p>콘(포장불가)</p>
            <div class="quantity-price">
              <button onclick="changeQuantityForOption(-1, 'cone'); event.stopPropagation();">-</button>
              <span id="finalQuantity-cone">0</span>
              <button onclick="changeQuantityForOption(1, 'cone'); event.stopPropagation();">+</button>
            </div>
          </div>
          <div class="option" onclick="selectOption('waffle')">
            <img src="./pd_corn.png" alt="와플 이미지">
            <p>와플콘(포장불가)</p>
            <div class="quantity-price">
              <button onclick="changeQuantityForOption(-1, 'waffle'); event.stopPropagation();">-</button>
              <span id="finalQuantity-waffle">0</span>
              <button onclick="changeQuantityForOption(1, 'waffle'); event.stopPropagation();">+</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 플레이버 탭 -->
    <div id="flavorTab" class="tab-content">
      <!-- 맛 선택 슬롯들 (동적으로 생성됨) -->
      <div class="flavor-slots-container"></div>
      <div class="flavor-panels">
        <div class="flavor-panel active" id="flavorPanel1">
          <h3>플레이버 1페이지</h3>
          <div class="flavor-grid">
            <img src="./flavor1.png" alt="소금 우유 아이스크림" onclick="selectFlavor(this)">
            <img src="./flavor2.png" alt="그린티" onclick="selectFlavor(this)">
            <img src="./flavor3.png" alt="나주배 소르베" onclick="selectFlavor(this)">
            <img src="./flavor4.png" alt="너는 참 달고나" onclick="selectFlavor(this)">
            <img src="./flavor5.png" alt="뉴욕치즈케이크" onclick="selectFlavor(this)">
            <img src="./flavor6.png" alt="딸기연유퐁당" onclick="selectFlavor(this)">
            <img src="./flavor7.png" alt="레인보우샤베트" onclick="selectFlavor(this)">
            <img src="./flavor8.png" alt="말랑꿀떡모찌" onclick="selectFlavor(this)">
            <img src="./flavor9.png" alt="민트초코" onclick="selectFlavor(this)">
            <img src="./flavor10.png" alt="바람과 함께 사라지다" onclick="selectFlavor(this)">
            <img src="./flavor11.png" alt="베리베리 스트로베리" onclick="selectFlavor(this)">
            <img src="./flavor12.png" alt="봉쥬르 마카롱" onclick="selectFlavor(this)">
          </div>
        </div>
        <div class="flavor-panel" id="flavorPanel2">
          <h3>플레이버 2페이지</h3>
          <div class="flavor-grid">
            <img src="./flavor13.png" alt="블루베리 파나코타" onclick="selectFlavor(this)">
            <img src="./flavor14.png" alt="사랑에 빠진 딸기" onclick="selectFlavor(this)">
            <img src="./flavor15.png" alt="슈팅스타" onclick="selectFlavor(this)">
            <img src="./flavor16.png" alt="아몬드 봉봉" onclick="selectFlavor(this)">
            <img src="./flavor17.png" alt="아이스 도쿄바나나" onclick="selectFlavor(this)">
            <img src="./flavor18.png" alt="아이스 호떡" onclick="selectFlavor(this)">
            <img src="./flavor19.png" alt="아이스초코도쿄바나나" onclick="selectFlavor(this)">
            <img src="./flavor20.png" alt="애플민트" onclick="selectFlavor(this)">
            <img src="./flavor21.png" alt="엄마는 외계인" onclick="selectFlavor(this)">
            <img src="./flavor22.png" alt="에스프레소 앤 크림" onclick="selectFlavor(this)">
            <img src="./flavor23.png" alt="오레오 쿠키 앤 크림" onclick="selectFlavor(this)">
            <img src="./flavor24.png" alt="이상한 나라의 솜사탕" onclick="selectFlavor(this)">
          </div>
        </div>
      </div>
      <div class="pagination">
        <button onclick="showFlavorPanel(1)" data-page="1"></button>
        <button onclick="showFlavorPanel(2)" data-page="2"></button>
      </div>
    </div>

    <!-- 하단 영역 -->
    <div class="bottom-actions">
      <div class="quantity-price">
        <p style="margin: 0;">합계 가격: ₩<span id="totalPrice">3200</span></p>
      </div>
      <div class="navigation-buttons">
        <button onclick="goBackToTestPage()" class="btn-back">이전</button>
        <button onclick="saveOrderData()" class="btn-cart">담기</button>
      </div>
    </div>
  </div>
  
  <script>
    // 전역 객체: 선택된 옵션, 수량, 맛, 단가, 그리고 선택된 맛 배열
// 전역 객체: 선택된 옵션, 수량, 맛, 단가, 그리고 선택된 맛 배열
var orderData = {
  cupQuantity: 0,
  coneQuantity: 0,
  waffleQuantity: 0,
  price: 3200,         // 단가 (unit price)
  totalQuantity: 0,    // 초기값: 각 옵션 1개씩
  optionType: null,    // 사용자가 선택한 옵션 (cup, cone, waffle)
  flavor: null,        // 최근 선택된 맛 (참고용 단일 값)
  maxFlavors: 3,       // 기본값: 파인트(3개). 실제 값은 제품명에 따라 변경됨
  selectedFlavors: []  // 선택된 맛들을 순서대로 저장 (배열 길이 == maxFlavors)
};

var activeFlavorSlotIndex = 0; // 현재 활성화된 맛 슬롯 인덱스

document.addEventListener("DOMContentLoaded", function () {
  // 헤더 동적 삽입 (header.html에 상단바 디자인 포함)
  fetch("header.html")
    .then(response => response.text())
    .then(data => {
      const headerContainer = document.getElementById("header-container");
      if (headerContainer) {
        headerContainer.innerHTML = data;
      }
    });

  // 푸터 동적 삽입 (필요 시 footer.html 사용)
  fetch("footer.html")
    .then(response => response.text())
    .then(data => {
      const footerContainer = document.getElementById("footer-container");
      if (footerContainer) {
        footerContainer.innerHTML = data;
      }
    });

  // 닫기 버튼 동작 추가 (header의 X 버튼)
  document.addEventListener("click", function (event) {
    if (event.target.classList.contains("close-btn")) {
      window.location.href = "test.html";
    }
  });

  // URL 파라미터에서 상품명, 가격 저장
  const params = new URLSearchParams(window.location.search);
  const name = params.get("name");
  const price = params.get("price");
  if (name) {
    document.getElementById("product-name").textContent = name;
    // 제품명에 따라 맛 선택 슬롯 개수를 결정
    if (name === "싱글레귤러" || name === "싱글킹") {
      orderData.maxFlavors = 1;
    } else if (name === "더블주니어" || name === "더블레귤러") {
      orderData.maxFlavors = 2;
    } else if (name === "파인트") {
      orderData.maxFlavors = 3;
    } else if (name === "쿼터") {
      orderData.maxFlavors = 4;
    } else if (name === "패밀리") {
      orderData.maxFlavors = 5;
    } else if (name === "하프갤런") {
      orderData.maxFlavors = 6;
    } else {
      orderData.maxFlavors = 3; // 기본값
    }
  }
  if (price) {
    const parsedPrice = parseInt(price, 10);
    document.getElementById("product-price").textContent = `₩${parsedPrice.toLocaleString('ko-KR')}`;
    orderData.price = parsedPrice; // 단가 저장
    // 총 가격은 나중에 updateTotalQuantityAndPrice()에서 계산
    updateTotalQuantityAndPrice();
  }
  
  // 맛 슬롯 생성: orderData.maxFlavors 개수만큼 동적으로 생성
  generateFlavorSlots();
  
  // 초기 페이지네이션 활성화 (플레이버 1페이지)
  document.querySelector('.pagination button[data-page="1"]').classList.add('active');
});

function goBackToTestPage() {
  window.location.href = "test.html";
}

function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(function(tab) {
    tab.classList.remove('active');
  });
  document.getElementById(tabId).classList.add('active');
  document.getElementById("tabProduct").classList.toggle("active", tabId === "productTab");
  document.getElementById("tabFlavor").classList.toggle("active", tabId === "flavorTab");
}

function showFlavorPanel(page) {
  document.querySelectorAll('.flavor-panel').forEach(function(panel) {
    panel.classList.remove('active');
  });
  const targetPanel = document.getElementById('flavorPanel' + page);
  if (targetPanel) {
    targetPanel.classList.add('active');
  } else {
    console.error('flavorPanel' + page + ' 요소를 찾을 수 없습니다.');
  }
  // 페이지네이션 인디케이터 업데이트
  document.querySelectorAll('.pagination button').forEach((btn) => {
    if (btn.getAttribute('data-page') === page.toString()) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

function selectFlavor(imgElement) {
  // 현재 활성 슬롯 가져오기
  let slot = document.querySelector(`.flavor-slot[data-slot-index="${activeFlavorSlotIndex}"]`);
  if (!slot) {
    alert("먼저 맛 선택 슬롯을 선택해 주세요.");
    return;
  }
  // 슬롯에 이미지 태그 채워넣기 (CSS에서 크기에 맞게 조정)
  slot.innerHTML = `<img src="${imgElement.src}" alt="${imgElement.alt}">`;
  // 선택된 맛을 orderData.selectedFlavors 배열에 저장
  orderData.selectedFlavors[activeFlavorSlotIndex] = imgElement.alt;
  // 최신 선택한 맛 (참고용) 업데이트
  orderData.flavor = imgElement.alt;
  console.log("선택된 맛 슬롯 업데이트:", orderData.selectedFlavors);
}

function selectOption(option) {
  console.log("선택된 옵션:", option);
  orderData.optionType = option;
}

function changeQuantityForOption(delta, option) {
  let spanId = "finalQuantity-" + option;
  let qtyElem = document.getElementById(spanId);
  let current = parseInt(qtyElem.textContent, 10);
  current = Math.max(0, current + delta); // 0부터 시작 (맛 선택 수량은 0부터)
  qtyElem.textContent = current;
  if (option === "cup") {
    orderData.cupQuantity = current;
  } else if (option === "cone") {
    orderData.coneQuantity = current;
  } else if (option === "waffle") {
    orderData.waffleQuantity = current;
  }
  updateTotalQuantityAndPrice();
}

function updateTotalQuantityAndPrice() {
  orderData.totalQuantity = orderData.cupQuantity + orderData.coneQuantity + orderData.waffleQuantity;
  // 총 가격(totalPrice)을 새로 계산해서 저장
  orderData.totalPrice = orderData.totalQuantity * orderData.price;
  document.getElementById("totalPrice").textContent =
    orderData.totalPrice.toLocaleString('ko-KR');
}

// 맛 슬롯 생성 함수: flavor-slots-container 내에 orderData.maxFlavors 개의 슬롯 생성
function generateFlavorSlots() {
  const container = document.querySelector('.flavor-slots-container');
  container.innerHTML = '';
  orderData.selectedFlavors = [];
  for (let i = 0; i < orderData.maxFlavors; i++) {
    orderData.selectedFlavors.push(null);
    const slot = document.createElement('div');
    slot.className = 'flavor-slot';
    slot.setAttribute('data-slot-index', i);
    slot.innerHTML = '<span class="slot-placeholder">+</span>';
    slot.addEventListener('click', function(e) {
      e.stopPropagation();
      setActiveFlavorSlot(i);
    });
    container.appendChild(slot);
  }
  // 기본 활성 슬롯 0
  setActiveFlavorSlot(0);
}

function setActiveFlavorSlot(index) {
  activeFlavorSlotIndex = index;
  document.querySelectorAll('.flavor-slot').forEach((slot, i) => {
    if (i === index) {
      slot.classList.add('active');
    } else {
      slot.classList.remove('active');
    }
  });
}

function saveOrderData() {
  console.log("최종 주문 데이터:", orderData);
  // price 값을 총가격(totalPrice)으로 덮어씁니다.
  orderData.price = orderData.totalPrice;
  
  // 기존 cartOrders 배열을 불러와 새 주문 데이터를 누적합니다.
  var cartOrders = JSON.parse(localStorage.getItem("cartOrders") || "[]");
  cartOrders.push(orderData);
  localStorage.setItem("cartOrders", JSON.stringify(cartOrders));
  
  // 별도의 alert 없이 test.html로 즉시 이동
  window.location.href = "test.html";
}

  </script>
</body>
</html>
